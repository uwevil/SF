\documentclass[a4paper,11pt]{report}
\usepackage[french]{babel}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage{microtype}
\usepackage{hyperref}
\usepackage{tabulary}
\usepackage{framed}
\usepackage{fancyhdr}
\usepackage{amsmath}
\usepackage{bbm}
\usepackage{graphicx}

\newcommand{\latin}[1]{\textit{#1}}

\usepackage{anysize}
%left,right, top, bottom
\marginsize{0.8in}{0.8in}{0.8in}{0.8in}


\pagestyle{empty}

\pagestyle{fancy}
\fancyhead{}
\renewcommand{\headrulewidth}{0.5pt}
\fancyhead[L]{\textit{\nouppercase{\leftmark}}}
\fancyfoot{}
\renewcommand{\footrulewidth}{0.5pt}
\fancyfoot[R]{\thepage}

\begin{document}
	\begin{titlepage}
		\vspace*{\stretch{2}}
		\begin{center}
			\large\bfseries\itshape Projet SF\\
		\end{center}
		\noindent\rule{\linewidth}{3pt}

		\begin{center}
			\Huge\bfseries\itshape RAPPORT\\
		\end{center}
		
		\noindent\rule{\linewidth}{3pt}
		\begin{center}
			\bfseries
			\large Modèlisation et Vérification du comportement de véhicules automatiques sur un pont à voie unique
			
		\end{center}
		\vspace*{\stretch{2}}
		\begin{center}
			Réalisé par \bfseries \itshape DOAN Cao Sang
		\end{center}
		\begin{center}
			\today
		\end{center}
	\end{titlepage}

\chapter{Propriété}
	{\huge \itshape L}e programme doit satisfaire les propriétés suivantes:
		\begin{enumerate}
			\item Il n'y a pas de collision (i.e. deux véhicules circulants en sens inverse) sur le pont.
			\item Un véhicule qui arrive est certain de passer sur le pont à l'issue d'une durée bornée.
		\end{enumerate}
	
\chapter{Explication}
\section{Question 1.1}
\subsection{Vaa}
	\begin{description}
		\item[VerificationA] est une place sortie, qui lie le composant \textit{Vaa} avec le contrôlleur \textit{CTRLP}, lorsque un véhicule A veut traverser le pont, d'abord il communique avec le contrôlleur \textit{CTRLP} pour avoir son autorisation.
		\item[OKControlleurA] est une place entrée qui lie entre \textit{Vaa} et \textit{CTRLP}, lorsque le \textit{Vaa} peut traverser sur le pont, le \textit{CTRLP} met son jeton pour que \textit{Vaa} puisse passer.
		\item[OKPont] est une place entrée qui lie le \textit{P} avec le \textit{Vaa}, le \textit{P} marque cette place lors qu'il reçoit l'autorisation de contrôlleur \textit{CTRLP}.
		\item[AuRevoirControlleurA] est une place sortie, le \textit{Vaa} marque cette place dès qu'il sort du \textit{P}.
	\end{description}	
	
	\subsection{Vab}
	\begin{description}
		\item[VerificationB] est une place sortie, qui lie le composant \textit{Vab} avec le contrôlleur \textit{CTRLP}, lorsque un véhicule B veut traverser le pont, d'abord il communique avec le contrôlleur \textit{CTRLP} pour avoir son autorisation.
		\item[OKControlleurB] est une place entrée qui lie entre \textit{Vab} et \textit{CTRLP}, lorsque le \textit{Vab} peut traverser sur le pont, le \textit{CTRLP} met son jeton pour que \textit{Vab} puisse passer.
		\item[OKPont] est une place entrée qui lie le \textit{P} avec le \textit{Vab}, le \textit{P} marque cette place lors qu'il reçoit l'autorisation de contrôlleur \textit{CTRLP}.
		\item[AuRevoirControlleurB] est une place sortie, le \textit{Vab} marque cette place dès qu'il sort du \textit{P}.
	\end{description}	
	
	\subsection{Pont}
	\begin{description}
		\item[CapaciteControlleur] est une place sortie, qui lie le composant \textit{P} avec le contrôlleur \textit{CTRLP} pour lui signaler sa capacité restante.
		\item[OKPont] est une place sortie qui lie le \textit{P} avec les 2 composants \textit{Vaa} et \textit{Vab}, le \textit{P} marque cette place lorsque sa capacité reste suffisante.
	\end{description}	
	
	\subsection{CTRLP}
	\begin{description}
		\item[VerificationA] est une place entrée, qui lie le composant \textit{Vaa} avec le contrôlleur \textit{CTRLP}, lorsque un véhicule A veut traverser le pont, le \textit{CTRLP} doit d'abord, recevoir sa demande.
		\item[VerificationB] est une place entrée, qui lie le composant \textit{Vab} avec le contrôlleur \textit{CTRLP}, lorsque un véhicule B veut traverser le pont, le \textit{CTRLP} doit d'abord, recevoir sa demande.
		\item[OKControlleurA] est une place sortie qui lie entre \textit{Vaa} et \textit{CTRLP}, lorsque le \textit{Vaa} peut traverser sur le pont, le \textit{CTRLP} met son jeton pour que \textit{Vaa} puisse passer.
		\item[OKControlleurB] est une place sortie qui lie entre \textit{Vab} et \textit{CTRLP}, lorsque le \textit{Vab} peut traverser sur le pont, le \textit{CTRLP} met son jeton pour que \textit{Vab} puisse passer.
		\item[CapaciteControlleur] est une place entrée, qui lie le composant \textit{P} avec le contrôlleur \textit{CTRLP} pour savoir la capacité restante du \textit{P}.
		\item[AuRevoirControlleurA] est une place entrée, cette place est marqué par le \textit{Vaa}.
		\item[AuRevoirControlleurB] est une place entrée, cette place est marqué par le \textit{Vab}.
	\end{description}	
	
\section{Question 1.2}
	Cette composant contient 8 places, dont 4 ont pour le rôle d'interface, et 3 transitions.
	
	La place \textbf{VehiculeA} modélise le véhicule A  lors qu'il arrive devant le pont. S'il veut passer sur le pont, d'abord, il communique avec le contrôlleur par la transition \textit{demanderEntrerA}, cette transition met un jeton dans l'interface \textbf{VerificationA} qui lie avec le contrôlleur \textit{CTRLP} et passe à l'état \textbf{AttenteAutorisationA}. Lorsqu'il reçoit l'autorisation du contrôlleur \textit{CTRLP} via l'interface \textbf{OKControlleurA} et celle du pont \textit{P} via l'interface \textbf{OKPont}, il peut traverser le pont, en passant à l'état \textbf{DansPontA}. Ensuite, quand il sort, il marque la place d'interface \textbf{AuRevoirControlleurA} et aussi passe à l'état \textbf{FiniA} par la transition \textit{sortPontA}.
	
	La sécurité est garantie car, pour passer à l'état \textbf{AttenteAutorisationA} le véhicule doit communiquer avec le contrôlleur \textit{CTRLP}. Pour entrer, il doit avoir l'autorisation du contrôlleur \textit{CTRLP} et consommer le jeton dans la place d'interface \textbf{OKPont},  cette place modélise la consommation de la capacité du pont \textit{P}. Enfin, il signale sa sortie du pont au contrôlleur \textit{CTRLP} en mettant un jeton dans la place \textbf{AuRevoirControlleurA}.

	\begin{figure}[!htbp]
		\centering
		\includegraphics[width = 15cm]{vaaModel.png}
		\caption{Le composant modélise le véhicule automatisée A.}
	\end{figure}
	\newpage
	
\section{Question 1.3}
	Cette composant est identique avec celle de véhicule A, contient 8 places, dont 4 ont pour le rôle d'interface, et 3 transitions.
	
	La place \textbf{VehiculeB} modélise le véhicule B  lors qu'il arrive devant le pont. S'il veut passer sur le pont, d'abord, il communique avec le contrôlleur par la transition \textit{demanderEntrerB}, cette transition met un jeton dans l'interface \textbf{VerificationB} qui lie avec le contrôlleur \textit{CTRLP} et passe à l'état \textbf{AttenteAutorisationB}. Lorsqu'il reçoit l'autorisation du contrôlleur \textit{CTRLP} via l'interface \textbf{OKControlleurB} et celle du pont \textit{P} via l'interface \textbf{OKPont}, il peut traverser le pont, en passant à l'état \textbf{DansPontB}. Ensuite, quand il sort, il marque la place d'interface \textbf{AuRevoirControlleurB} et aussi passe à l'état \textbf{FiniB} par la transition \textit{sortPontB}.
	
	La sécurité est garantie car, pour passer à l'état \textbf{AttenteAutorisationB} le véhicule doit communiquer avec le contrôlleur \textit{CTRLP}. Pour entrer, il doit avoir l'autorisation du contrôlleur \textit{CTRLP} et consommer le jeton dans la place d'interface \textbf{OKPont},  cette place modélise la consommation de la capacité du pont \textit{P}. Enfin, il signale sa sortie du pont au contrôlleur \textit{CTRLP} en mettant un jeton dans la place \textbf{AuRevoirControlleurB}.

		\begin{figure}[!htbp]
		\centering
		\includegraphics[width = 15cm]{vabModel.png}
		\caption{Le composant modélise le véhicule automatisée B.}
	\end{figure}
	\newpage
	
	
\section{Question 1.4}
	Le comportement d'un pont est simple, il notifie  sa capacité au contrôlleur \textit{CTRLP} et diminue si consomé par un véhicule. Donc, il contient 3 places, dont 2 interfaces et une transition.
	
	La transition \textit{notifieCapacite} marque 2 interfaces \textbf{CapaciteControlleur} et \textbf{OKPont} par 2 jetons, 1 pour chaque.

	\begin{figure}[!htbp]
		\centering
		\includegraphics[width = 15cm]{pontModel.png}
		\caption{Le composant modélise le pont.}
	\end{figure}
	\newpage
	
\section{Question 1.5}
	Ce composant contient 12 places dont 7 interfaces, et 6 transitions.
	
	Lorsque le \textit{CTRLP} reçoit une demande d'entrer d'une véhicule \textit{Vaa} (idem, \textit{Vab}), il vérifie le sens actuel (initilise à 1, direction de A vers B) est correspondant à celui de \textit{Vaa}, le timeout restant, le nombre \textit{Nalt} restant et la capacité \textit{CapaP} restant du pont. Si ces conditions sont satisfaits, alors le contrôlleur \textit{CTRLP} donne l'autorisation au véhicule en attente. Quand le véhicule sort du pont, le contrôlleur reçoit son signal. 
	
	Le timeout est modélisé par une place nommée \textit{TimeOut} avec une seule transition \textit{ecoule}. Le \textit{TimeOut} décrémente une unité de temps automatique indépendamment avec le système. Lors de l'expiration de \textit{TimeOut}, il réinitialise le \textit{Nalt}, lui même, et change la direction actuelle.  Idem pour le \textit{Nalt}, si \textit{Nalt} = 0, il réinitialise le \textit{TimeOut}, \textit{Nalt} et change la direction.
	
	Quand la capacité du pont est à 0, alors aucun véhicule peut utiliser ce pont.

	\begin{figure}[!htbp]
		\includegraphics[width = 18cm]{ctrlpModel.png}
		\caption{Le composant modélise le pont.}
	\end{figure}
	\newpage
	
\section{Question 1.6}
	
	
\begin{verbatim}
query node ((card(DansPontA)==1) and (card(DansPontB)==1))



	========================================================
This service relies on the prod model checker developped
at the Helsinki University of technology  (laboratory of
computer  science,  http://www.tcs.hut.fi/Software/prod)
========================================================

Integration in CosyVerif by F. Kordon (UPMC, 2013)

Installing Prod
Installing gph2dot
Installing model data for persistent storage
PN syntax checker by X. Bonnaire 1992-1996, A. Diagne 1996-1997, I. Mounier 1993-2002, J.-L. Mounier 1998-2006
Statistics for this net
Number of places      22
Number of Queues      0
Number of Transitions 13
Number of arcs        55
Generating prod format
Generating and compiling code for the model
Generating the state space (this may take a while;-)

---
Statistics about the reachability graph provided by prod are shown below
Number of nodes: 283688
Number of arrows: 1033700
Number of terminal nodes: 0
Number of nodes that have been completely processed: 283688
Number of strongly connected components: 229305
Number of nontrivial terminal strongly connected components: 1
Evaluating the provided CTL formula
0 paths
Built set %1
------------------------------------------------

========================================================
Service completed OK
========================================================

Debug information
========================================================
CosyVerif directory  -> /tmp/alligator-5454896919309414835
Persostent directory -> /tmp/ProdInCosyVerif_f369dd251b6b1eac4a8afd256ef6d33b
========================================================
Execution trace follows below
+ '[' '!' -f prod_model ']'
+ echo 'PN syntax checker by X. Bonnaire 1992-1996, A. Diagne 1996-1997, I. Mounier 1993-2002, J.-L. Mounier 1998-2006'
+ /tmp/ProdInCosyVerif_f369dd251b6b1eac4a8afd256ef6d33b/FkSandrine -s -i prod_8763807886865996390.cami -o camix_model
+ '[' '!' -f .stats ']'
++ wc -c
++ grep colores .qualif
+ CLASS=8
+ sed -e s/://
+ cat .stats
+ echo 'Generating prod format'
+ /tmp/ProdInCosyVerif_f369dd251b6b1eac4a8afd256ef6d33b/matrice -s -i camix_model -m rdp_matrix -p prod_model.net
++ tr -s ' '
++ cut -d ' ' -f 2
++ wc -l rdp_matrix
+ CHECK=rdp_matrix
+ '[' rdp_matrix = 0 ']'
++ grep NAME_NOT_IDENTIFIER matrice_output
+ '[' '' ']'
+ '[' -f prod_model.gph ']'
+ echo 'Generating and compiling code for the model'
+ prod prod_model.init
+ '[' -f prod_model ']'
+ echo 'Generating the state space (this may take a while;-)'
+ ./prod_model -m 1024000

./prod_model.aws is used directly

./prod_model.gph is used directly

./prod_model.adr is used directly
+ echo statistics
+ strong prod_model
+ sed -e s/.#//g
+ probe prod_model
+ echo ---
+ echo 'Statistics about the reachability graph provided by prod are shown below'
+ cat statistics.data
+ echo 'Evaluating the provided CTL formula'
+ cat ctl.prb prod_801592428106530532.ctlprod
+ sed -e 's/.*#//g'
+ probe prod_model
+ cat prod_formula_result

query node (AttenteAutorisationA == FiniA) // OK trace

========================================================
This service relies on the prod model checker developped
at the Helsinki University of technology  (laboratory of
computer  science,  http://www.tcs.hut.fi/Software/prod)
========================================================

Integration in CosyVerif by F. Kordon (UPMC, 2013)

Prod binaries checked OK
Gph2dot checked OK
Reachability Graph already computed, retrieving data
---
Statistics about the reachability graph provided by prod are shown below
Number of nodes: 283688
Number of arrows: 1033700
Number of terminal nodes: 0
Number of nodes that have been completely processed: 283688
Number of strongly connected components: 229305
Number of nontrivial terminal strongly connected components: 1
Evaluating the provided CTL formula


26672 paths
Built set %1
------------------------------------------------

========================================================
Service completed OK
========================================================

Debug information
========================================================
CosyVerif directory  -> /tmp/alligator-2047358861068064411
Persostent directory -> /tmp/ProdInCosyVerif_f369dd251b6b1eac4a8afd256ef6d33b
========================================================
Execution trace follows below
+ '[' '!' -f prod_model ']'
+ '[' -f prod_model.gph ']'
+ echo 'Reachability Graph already computed, retrieving data'
+ echo ---
+ echo 'Statistics about the reachability graph provided by prod are shown below'
+ sed -e s/0#// statistics.data
+ echo 'Evaluating the provided CTL formula'
+ cat ctl.prb prod_1231987064332949103.ctlprod
+ sed -e 's/.*#//g'
+ probe prod_model
+ cat prod_formula_result

query node (card(Sens) == 2) // oK 0 path


========================================================
This service relies on the prod model checker developped
at the Helsinki University of technology  (laboratory of
computer  science,  http://www.tcs.hut.fi/Software/prod)
========================================================

Integration in CosyVerif by F. Kordon (UPMC, 2013)

Prod binaries checked OK
Gph2dot checked OK
Reachability Graph already computed, retrieving data
---
Statistics about the reachability graph provided by prod are shown below
Number of nodes: 283688
Number of arrows: 1033700
Number of terminal nodes: 0
Number of nodes that have been completely processed: 283688
Number of strongly connected components: 229305
Number of nontrivial terminal strongly connected components: 1
Evaluating the provided CTL formula
0 paths
Built set %1
------------------------------------------------

========================================================
Service completed OK
========================================================

Debug information
========================================================
CosyVerif directory  -> /tmp/alligator-8223995637312865004
Persostent directory -> /tmp/ProdInCosyVerif_f369dd251b6b1eac4a8afd256ef6d33b
========================================================
Execution trace follows below
+ '[' '!' -f prod_model ']'
+ '[' -f prod_model.gph ']'
+ echo 'Reachability Graph already computed, retrieving data'
+ echo ---
+ echo 'Statistics about the reachability graph provided by prod are shown below'
+ sed -e s/0#// statistics.data
+ echo 'Evaluating the provided CTL formula'
+ cat ctl.prb prod_1904795993131222933.ctlprod
+ sed -e 's/.*#//g'
+ probe prod_model
+ cat prod_formula_result


query node ((card(FiniA) == 2) and (card(FiniB) == 2)) // OK

========================================================
This service relies on the prod model checker developped
at the Helsinki University of technology  (laboratory of
computer  science,  http://www.tcs.hut.fi/Software/prod)
========================================================

Integration in CosyVerif by F. Kordon (UPMC, 2013)

Prod binaries checked OK
Gph2dot checked OK
Reachability Graph already computed, retrieving data
---
Statistics about the reachability graph provided by prod are shown below
Number of nodes: 283688
Number of arrows: 1033700
Number of terminal nodes: 0
Number of nodes that have been completely processed: 283688
Number of strongly connected components: 229305
Number of nontrivial terminal strongly connected components: 1
Evaluating the provided CTL formula

40 paths
Built set %1
------------------------------------------------

========================================================
Service completed OK
========================================================

Debug information
========================================================
CosyVerif directory  -> /tmp/alligator-8573433729245045077
Persostent directory -> /tmp/ProdInCosyVerif_f369dd251b6b1eac4a8afd256ef6d33b
========================================================
Execution trace follows below
+ '[' '!' -f prod_model ']'
+ '[' -f prod_model.gph ']'
+ echo 'Reachability Graph already computed, retrieving data'
+ echo ---
+ echo 'Statistics about the reachability graph provided by prod are shown below'
+ sed -e s/0#// statistics.data
+ echo 'Evaluating the provided CTL formula'
+ cat ctl.prb prod_2927488966804921096.ctlprod
+ sed -e 's/.*#//g'
+ probe prod_model
+ cat prod_formula_result


query node ((DansPontA == <.1.> and DansPontB == <.1.>) or (DansPontA == <.1.> and DansPontB == <.2.>)) // OKKKK 0 path

========================================================
This service relies on the prod model checker developped
at the Helsinki University of technology  (laboratory of
computer  science,  http://www.tcs.hut.fi/Software/prod)
========================================================

Integration in CosyVerif by F. Kordon (UPMC, 2013)

Prod binaries checked OK
Gph2dot checked OK
Reachability Graph already computed, retrieving data
---
Statistics about the reachability graph provided by prod are shown below
Number of nodes: 283688
Number of arrows: 1033700
Number of terminal nodes: 0
Number of nodes that have been completely processed: 283688
Number of strongly connected components: 229305
Number of nontrivial terminal strongly connected components: 1
Evaluating the provided CTL formula
0 paths
Built set %1
------------------------------------------------

========================================================
Service completed OK
========================================================

Debug information
========================================================
CosyVerif directory  -> /tmp/alligator-6888013607560646498
Persostent directory -> /tmp/ProdInCosyVerif_f369dd251b6b1eac4a8afd256ef6d33b
========================================================
Execution trace follows below
+ '[' '!' -f prod_model ']'
+ '[' -f prod_model.gph ']'
+ echo 'Reachability Graph already computed, retrieving data'
+ echo ---
+ echo 'Statistics about the reachability graph provided by prod are shown below'
+ sed -e s/0#// statistics.data
+ echo 'Evaluating the provided CTL formula'
+ cat ctl.prb prod_3538640120971840321.ctlprod
+ sed -e 's/.*#//g'
+ probe prod_model
+ cat prod_formula_result


\end{verbatim}	
	
\end{document}

